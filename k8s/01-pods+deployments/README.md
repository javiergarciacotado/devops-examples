# Pods and deployments: Managing containers

k8s wraps the container in another virtualized environment: the Pod. A Pod is a unit of compute, which runs on a single node in the cluster. It has its own virtual IP address, which is managed by k8s.
You normally run one container in a Pod, but you can run multiple containers in one Pod. All the containers in a Pod are part of the same virtual environment, so they share the same network address and can comunicate using localhost.

**Containers run inside _Pods_. You manage the _Pods_, and the Pods manage the containers.**

## Load images from your local environment

When playing with k8s, Docker and other cool stuff, we are used to use public images for doing so... Actually, \*skip this section if you want to continue doing that. If not, what happens if you want to play with a container image in (and only in) your laptop? One solution for that will be to push your image to one of the cluster nodes:

```
    :~$ kind load help

    Available Commands:
    docker-image  Loads docker image from host into nodes
    image-archive Loads docker image from archive into nodes

    :~$ cat > Dockerfile << EOF
        heredoc> FROM alpine:3.14.2
        heredoc> CMD "sleep 10000"
        heredoc> EOF

    :~$ docker build -t getting-started:1.0.0 .
    :~$

```

# WIP

```
    :~$ kubectl run <Pod_name> --image=<image> --restart=Never
    :~$ kubectl wait --for=condition=Ready pod <name>
    :~$ kubectl get pods
    :~$ kubectl describe pod <Pod_name>
    :~$ kubectl get pod <Pod_name> -o json
    :~$ kubectl get pod <Pod_name> --output custom-columns=NAME:metadata.name,NODE_IP:status.hostIP,POD_IP:status.podIP #custom-columns values retrieve from above json path
```

_Pods_ are allocated to one node when they are created, and it's that node's responsability to manage the Pod and its containers.

```
    :~$ kubectl get po
    :~$ kubectl port-forward pod/<Pod_name> <outside_port>:<container_port>
```

_Pods_ are too simple to be useful on their own: they are isolated instances of an app and each Pod is allocated in a node of the cluster. What happens if that node goes offline? is the pod lost? (Yes), does k8s replace it? (No) you can think to replicate the pods over the nodes of the cluster? (Yes && No ... because how are you going to manage all of them?)

.... That's where _Controllers_ come in ....

A _controller_ is a k8s resource that manages other resources. It works against the k8s API. From now on, I use the term _Deployment_ to talk about _controllers_.

_Pods_ which run containers, and _deployments_, which manages pods.

You can create _Deployment_ resources with kubectl:

```
    :~$ kubectl create deployment <deployment_name> --image=<image_name>
    :~$ kubectl create deployment <deployment_name> --image=<image_name>
```

Now you have 2 pods in the cluster --> one with random suffix generated by kubectl

```
    :~$ kubectl create deployment <deployment_name> --image=<image_name>
    :~$ kubectl get all
```

Remember, you created the deployment but you didn't directly create the _Pod_.

```
    :~$ kubectl get deploy <deployment_name> -o json
    :~$ kubectl get po -l app=<deployment_name>
```

Controllers identify the resources they manage by using labels and selectors
